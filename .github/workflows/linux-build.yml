
### Key Changes:
#1. **Added Cross-Compilation Tools**: Installed `gcc-arm-linux-gnueabihf`, `g++-arm-linux-gnueabihf` (for ARM) and `gcc-aarch64-linux-gnu`, `g++-aarch64-linux-gnu` (for AArch64) in the dependency step.
#
#2. **Updated Build Script Call**: Changed to use `scripts/linux/build_cmake-all.sh` with `all all` parameters to build all architectures and configurations.
#
#3. **Improved Artifact Preparation**: 
#   - Creates separate tarballs for each architecture (x64, x86, arm, aarch64)
#   - Uses the root `install` directory (instead of `build/install`) as the source
#   - Adds basic error checking for missing architecture directories
#
#4. **Updated Release Artifacts**: Includes all four architecture-specific tarballs in the GitHub release.
#
#5. **Enhanced Cache Key**: Added `**/*.sh` to the cache key to invalidate cache when build scripts change.{insert\_element\_0\_}```yaml
name: Linux Build and Release

on:
  push:
    tags:
      - 'v*' # Trigger release on version tags
  workflow_dispatch: # Allow manual trigger

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    # Explicitly grant permission to create/update releases
    permissions:
      contents: write
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        submodules: recursive

    - name: Install Dependencies
      run: |
        # Clean apt cache and force update
        sudo rm -rf /var/lib/apt/lists/*
        sudo apt-get update
        # Attempt to fix broken dependencies
        sudo apt-get install -f
        # Clean up any partial installs
        sudo apt-get autoremove && sudo apt-get autoclean
        # We only need the cross-toolchain packages, which exist in the amd64 repo.
        # Do NOT use 'dpkg --add-architecture' unless you need to install 
        # ARM-native libraries (like libssl-dev:arm64).
        sudo apt-get install -y \
          build-essential \
          cmake \
          patch \
          gcc-multilib \
          g++-multilib 
        # Clean up any partial installs
        sudo apt-get autoremove && sudo apt-get autoclean  

              
    - name: Cache Build Folder
      uses: actions/cache@v4
      with:
        path: build
        key: ${{ runner.os }}-build-${{ hashFiles('**/CMakeLists.txt', '**/*.sh') }}
        restore-keys: |
          ${{ runner.os }}-build-

    - name: Run Build Script
      run: |
        # Make sure the build script is executable
        chmod +x scripts/linux/build_cmake-all.sh
        # Build all architectures and configurations
        ./scripts/linux/build_cmake-all.sh

    - name: Prepare Artifacts for Release
      run: |
        # Create separate archives for each architecture
        # Create directory and compress based on matrix architecture
        mkdir -p release_dist
        for arch in x64; do
          if [ -d "install/$arch" ]; then
            tar -czvf "release_dist/libstack-linux-$arch.tar.gz" -C "install/$arch" .
            echo "Created archive for $arch"
          else
            echo "Warning: No installation files found for $arch"
          fi
        done
       
    - name: Create GitHub Release
      # Trigger if it's a tag OR if it's a manual trigger
      if: startsWith(github.ref, 'refs/tags/') || github.event_name == 'workflow_dispatch'
      uses: softprops/action-gh-release@v2
      with:
        files: |
          release_dist/libstack-linux-x64.tar.gz
        # Use tag name if available, otherwise use a default name
        name: Release ${{ github.ref_name || 'Manual Build' }}
        # If manually triggered, you might want to point it to a specific tag like 'latest'
        tag_name: ${{ github.ref_name || 'latest' }}
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
 
